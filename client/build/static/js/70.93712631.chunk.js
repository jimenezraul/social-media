"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[70],{5070:function(e,l,s){s.r(l),s.d(l,{Messages:function(){return b}});var n=s(1413),r=s(885),t=s(2791),a=s(4740),i=s(8729),o=s(1087),d=s(184),c=function(e){var l=e._id,s=e.given_name,n=e.family_name,r=e.profileUrl,t=e.isLast,a=e.isRead,i=e.setSelectedMessage;return(0,d.jsx)(o.rU,{onClick:i,to:"/messages/".concat(l),children:(0,d.jsxs)("div",{className:"hover:bg-slate-700 p-3 flex items-center bg-slate-800  ".concat(!t&&"border-b border-slate-700"," "),children:[a&&(0,d.jsx)("div",{className:"bg-green-500 h-2 w-2 rounded-full mr-2"}),(0,d.jsx)("img",{src:"".concat(r),alt:"avatar",className:"bg-default p-0.5 w-10 h-10 rounded-full",referrerPolicy:"no-referrer"}),(0,d.jsxs)("h1",{className:"ml-2",children:[s," ",n]})]})})},u=s(6578),f=s(2152),v=s(4165),m=s(5861),x=s(4376),h=s(1029),g=s(7689),p=function(e){var l,s=e.id,n=e.setSelectedMessage,a=(0,g.s0)(),i=(0,t.useState)([]),o=(0,r.Z)(i,2),c=o[0],p=o[1],w=(0,u.a)(f.xF),b=w.loading,j=w.data,N=w.error,y=(0,x.D)(h.ww),k=(0,r.Z)(y,1)[0],_=(0,x.D)(h.ce),C=(0,r.Z)(_,1)[0],Z=(0,t.useState)(),M=(0,r.Z)(Z,2),S=M[0],L=M[1],E=(0,t.useState)(""),U=(0,r.Z)(E,2),P=U[0],B=U[1],I=(0,t.useRef)(null);(0,t.useEffect)((function(){if(!s)return L(void 0),p([]),void B("")}),[s]),(0,t.useEffect)((function(){if(!b){if(N)return console.log(N);if(s&&j){var e,l,n,r,t=null===j||void 0===j||null===(e=j.me)||void 0===e||null===(l=e.messages)||void 0===l?void 0:l.map((function(e){var l;return null!==(l=e.members)&&void 0!==l&&l.map((function(e){return e._id})).includes(s)?e:null})).flat();p(t);var a=null===j||void 0===j||null===(n=j.me)||void 0===n||null===(r=n.friends)||void 0===r?void 0:r.filter((function(e){return e._id===s}));L(a[0])}else;}}),[j,s,c.length,b,N]),(0,t.useEffect)((function(){var e,l,s,n,r,t,a;function i(){return(i=(0,m.Z)((0,v.Z)().mark((function e(){var l;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C({variables:{messageId:null===(l=c[0])||void 0===l?void 0:l._id}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.length>0&&"delivered"===(null===(e=c[0])||void 0===e||null===(l=e.messages[(null===(s=c[0])||void 0===s?void 0:s.messages.length)-1])||void 0===l?void 0:l.status)&&(null===(n=c[0])||void 0===n||null===(r=n.messages[(null===(t=c[0])||void 0===t?void 0:t.messages.length)-1])||void 0===r?void 0:r.sender._id)!==(null===j||void 0===j||null===(a=j.me)||void 0===a?void 0:a._id)&&function(){i.apply(this,arguments)}()}),[c,C,j]);var q=null===j||void 0===j||null===(l=j.me)||void 0===l?void 0:l.friends.filter((function(e){return""===P?null:"".concat(e.given_name,"  ").concat(e.family_name).toLowerCase().includes(P.toLowerCase())})),z=function(){var e=(0,m.Z)((0,v.Z)().mark((function e(){var l,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==S&&""!==(null===(l=I.current)||void 0===l?void 0:l.value)){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,k({variables:{recipientId:S._id,message:null===(s=I.current)||void 0===s?void 0:s.value}});case 5:a("/messages/".concat(S._id)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:I.current.value="";case 12:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(){return e.apply(this,arguments)}}();return(0,d.jsx)("div",{className:"min-w-full border border-slate-700 rounded-lg overflow-hidden",children:(0,d.jsxs)("div",{className:"w-full flex flex-col max-h-full overflow-hidden",children:[(0,d.jsx)("div",{className:"relative flex items-center p-2 border-b border-slate-700 bg-slate-700",children:S?(0,d.jsxs)("div",{className:"flex items-center",children:[(0,d.jsx)("i",{onClick:n,className:"flex justify-center items-center md:hidden text-blue-500 bg-white rounded-full h-7 w-7 mr-2 text-3xl fa-solid fa-circle-left"}),(0,d.jsx)("img",{className:"object-cover w-10 h-10 rounded-full bg-default p-0.5",src:"".concat(S.profileUrl),alt:"".concat(S.given_name," ").concat(S.family_name),referrerPolicy:"no-referrer"}),(0,d.jsxs)("span",{className:"block ml-2 font-bold text-slate-300",children:[S.given_name," ",S.family_name]}),!s&&(0,d.jsxs)("button",{onClick:function(){L(void 0),p([]),B("")},type:"button",className:"absolute right-3 bg-slate-700 rounded-md p-2 inline-flex items-center justify-center text-gray-400 hover:text-slate-300 hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500",children:[(0,d.jsx)("span",{className:"sr-only",children:"Close menu"}),(0,d.jsx)("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})]})]}):(0,d.jsxs)("div",{className:"relative flex items-center w-full",children:[(0,d.jsx)("i",{onClick:n,className:"flex justify-center items-center md:hidden text-blue-500 bg-white rounded-full h-7 w-7 mr-2 text-3xl fa-solid fa-circle-left"}),(0,d.jsx)("input",{onChange:function(e){return B(e.target.value)},type:"text",placeholder:"Search for friends",className:"outline-none relative w-full bg-slate-800 text-gray-300 rounded-full border border-slate-600 p-2 indent-3"}),(0,d.jsx)("span",{className:"absolute right-6",children:(0,d.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,d.jsx)("div",{className:"".concat((null===q||void 0===q?void 0:q.length)>=1?"opacity-100":"opacity-0"," absolute z-50 p-2 top-12 w-full bg-slate-700 rounded-lg border border-slate-600"),children:null===q||void 0===q?void 0:q.map((function(e,l){var s=l===q.length-1;return(0,d.jsxs)("div",{onClick:function(){return function(e){L(e)}(e)},className:"".concat(!s&&"border-b border-slate-800"," hover:bg-slate-800 px-3 py-2 hover:rounded-lg flex items-center cursor-pointer"),children:[(0,d.jsx)("img",{src:"".concat(e.profileUrl),alt:"avatar",className:"bg-default p-0.5 w-10 h-10 rounded-full",referrerPolicy:"no-referrer"}),(0,d.jsxs)("h1",{className:"ml-2",children:[e.given_name," ",e.family_name]})]},l)}))})]})}),(0,d.jsx)("div",{className:"relative w-full p-6 overflow-y-auto max-h-65",children:(0,d.jsx)("ul",{className:"space-y-2",children:null===c||void 0===c?void 0:c.map((function(e){var l;return null===e||void 0===e||null===(l=e.messages)||void 0===l?void 0:l.map((function(l,s){var n,r,t;return s===(null===(n=e.messages)||void 0===n?void 0:n.length)-1&&setTimeout((function(){var e=document.getElementById("".concat(s));null===e||void 0===e||e.scrollIntoView({behavior:"smooth"})}),100),l.sender._id===(null===j||void 0===j||null===(r=j.me)||void 0===r?void 0:r._id)?(0,d.jsxs)("li",{id:"".concat(s),className:"flex justify-end",children:[(0,d.jsx)("div",{className:"relative max-w-xl px-5 py-1 text-white bg-blue-500 rounded-lg shadow",children:(0,d.jsx)("span",{className:"block",children:l.text})}),(0,d.jsx)("div",{className:"relative ml-2",children:(0,d.jsx)("img",{src:"".concat(null===j||void 0===j||null===(t=j.me)||void 0===t?void 0:t.profileUrl),alt:"avatar",className:"bg-default p-0.5 w-8 h-8 rounded-full",referrerPolicy:"no-referrer"})})]},s):(0,d.jsxs)("li",{id:"".concat(s),className:"flex justify-start",children:[(0,d.jsx)("div",{className:"relative mr-2",children:(0,d.jsx)("img",{src:"".concat(null===S||void 0===S?void 0:S.profileUrl),alt:"avatar",className:"bg-default p-0.5 w-8 h-8 rounded-full",referrerPolicy:"no-referrer"})}),(0,d.jsx)("div",{className:"relative max-w-xl px-5 py-1 text-white rounded-lg bg-green-500 shadow",children:(0,d.jsx)("span",{className:"block",children:l.text})})]},s)}))}))})}),(0,d.jsxs)("div",{className:"flex items-center justify-between w-full p-3 border-t border-slate-700 bg-slate-700",children:[(0,d.jsx)("input",{type:"text",placeholder:"Message",className:"block w-full py-2 pl-4 mx-3 bg-slate-800 rounded-full outline-none focus:text-white",name:"message",ref:I,required:!0}),(0,d.jsx)("button",{onClick:z,children:(0,d.jsx)("svg",{className:"w-8 h-8 text-slate-400 origin-center transform rotate-90 hover:text-slate-300 hover:scale-110 transition-all duration-200",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,d.jsx)("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})})})]})]})})},w=s(5478),b=function(){var e=(0,t.useState)(!1),l=(0,r.Z)(e,2),s=l[0],o=l[1],v=(0,g.UO)().id,m=(0,g.s0)(),x=(0,t.useState)([]),h=(0,r.Z)(x,2),b=h[0],j=h[1],N=(0,u.a)(f.xF),y=N.data,k=N.loading,_=N.error,C=N.subscribeToMore,Z=(0,a.C)(i.dy).user,M=window.location.pathname.split("/").includes("new");(0,t.useEffect)((function(){var e,l;if(!k)return _?console.log(_):void j(null===y||void 0===y||null===(e=y.me)||void 0===e||null===(l=e.messages)||void 0===l?void 0:l.map((function(e){var l,s,r,t=null===e||void 0===e||null===(l=e.members)||void 0===l?void 0:l.find((function(e){return e._id!==Z._id})),a="delivered"===(null===e||void 0===e||null===(s=e.messages[(null===e||void 0===e?void 0:e.messages.length)-1])||void 0===s?void 0:s.status)&&(null===e||void 0===e||null===(r=e.messages[(null===e||void 0===e?void 0:e.messages.length)-1])||void 0===r?void 0:r.sender._id)!==Z._id;return(0,n.Z)((0,n.Z)({},t),{},{isRead:a})})))}),[y,k,_,Z]),(0,t.useEffect)((function(){!v&&b.length>0&&!M&&m("/messages/".concat(b[0]._id))}),[v,b,m,M]),(0,t.useEffect)((function(){C&&(0,w.Jj)(C)}),[C]);var S=function(){o(!s)};return k?(0,d.jsx)("div",{className:"loader"}):_?(0,d.jsx)("div",{className:"error",children:_.message}):(0,d.jsx)("div",{className:"container mx-auto h-full",children:(0,d.jsxs)("div",{className:"flex flex-row justify-center",children:[(0,d.jsx)("div",{className:"p-1 ".concat(s?"hidden":"flex"," md:flex flex-col space-y-2 w-full md:w-4/12"),children:(0,d.jsxs)("div",{className:"text-slate-300 rounded-lg overflow-hidden border border-slate-700 shadow-lg",children:[(0,d.jsxs)("div",{className:"flex flex-row justify-between items-center bg-slate-700 px-5 py-3 border-b border-slate-800",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold",children:"Messages"}),(0,d.jsx)("i",{onClick:function(){o(!s),m("/messages/new")},className:"hover:text-blue-400 cursor-pointer text-2xl fa-solid fa-pen-to-square"})]}),b.length>0&&b.map((function(e,l){var s=l===b.length-1;return(0,d.jsx)(c,(0,n.Z)((0,n.Z)({},e),{},{isLast:s,setSelectedMessage:S}),l)}))]})}),(0,d.jsx)("div",{className:"p-1 ".concat(s?"flex w-full":"hidden"," md:flex md:w-8/12 lg:w-6/12 text-white"),children:(0,d.jsx)("div",{className:"flex flex-grow max-h-full bg-slate-800 rounded-lg",children:b.length||M?(0,d.jsx)("div",{className:"flex w-full h-full",children:(0,d.jsx)(p,{id:v,setSelectedMessage:S})}):(0,d.jsxs)("div",{className:"w-full flex flex-col justify-center items-center p-5",children:[(0,d.jsx)("h1",{className:"text-2xl font-bold",children:"No Messages"}),(0,d.jsxs)("p",{className:"text-center",children:["You have no messages yet. Click the"," ",(0,d.jsx)("span",{children:(0,d.jsx)("i",{className:"text-xl fa-solid fa-pen-to-square"})})," ","icon to start a new conversation."]})]})})})]})})}}}]);
//# sourceMappingURL=70.93712631.chunk.js.map